<?php
// Подключаем файлы с классами Database и Movie
require_once "database.php";
require_once "movie.php";
// Класс Favorites для работы с избранными фильмами и сериалами пользователя на устройстве пользователя в виде json файла
class Favorites {
  // Свойство класса для хранения пути к файлу с избранными фильмами и сериалами
  private static $file_path = "favorites.json";

  // Метод для добавления фильма или сериала в избранное на устройстве пользователя
  public static function add($title, $type) {
    // Получаем объект класса Movie с данными о фильме или сериале по названию из базы данных
    $movie = Movie::getOne($title, $type);
    // Проверяем, существует ли такой фильм или сериал в базе данных
    if ($movie) {
      // Если да, то читаем содержимое файла с избранными фильмами и сериалами в виде строки
      $json = file_get_contents(self::$file_path);
      // Преобразуем строку в ассоциативный массив
      $favorites = json_decode($json, true);
      // Проверяем, есть ли уже такой фильм или сериал в избранном
      if (in_array($title, $favorites[$type])) {
        // Если да, то возвращаем false, так как нельзя добавить повторно
        return false;
      } else {
        // Если нет, то добавляем название фильма или сериала в массив по соответствующему типу
        array_push($favorites[$type], $title);
        // Преобразуем массив обратно в строку
        $json = json_encode($favorites);
        // Перезаписываем файл с избранными фильмами и сериалами новой строкой
        file_put_contents(self::$file_path, $json);
        // Возвращаем true, так как добавление прошло успешно
        return true;
      }
    } else {
      // Если нет, то возвращаем false, так как нельзя добавить несуществующий фильм или сериал
      return false;
    }
  }

  // Метод для удаления фильма или сериала из избранного на устройстве пользователя
  public static function remove($title, $type) {
    // Читаем содержимое файла с избранными фильмами и сериалами в виде строки
    $json = file_get_contents(self::$file_path);
    // Преобразуем строку в ассоциативный массив
    $favorites = json_decode($json, true);
    // Проверяем, есть ли такой фильм или сериал в избранном
    if (in_array($title, $favorites[$type])) {
      // Если да, то удаляем название фильма или сериала из массива по соответствующему типу с помощью функции array_diff
      $favorites[$type] = array_diff($favorites[$type], [$title]);
      // Преобразуем массив обратно в строку
      $json = json_encode($favorites);
      // Перезаписываем файл с избранными фильмами и сериалами новой строкой
      file_put_contents(self::$file_path, $json);
      // Возвращаем true, так как удаление прошло успешно
      return true;
    } else {
      // Если нет, то возвращаем false, так как нельзя удалить несуществующий фильм или сериал
      return false;
    }
  }

  // Метод для получения списка всех избранных фильмов или сериалов на устройстве пользователя
  public static function getAll($type) {
    // Читаем содержимое файла с избранными фильмами и сериалами в виде строки
    $json = file_get_contents(self::$file_path);
    // Преобразуем строку в ассоциативный массив
    $favorites = json_decode($json, true);
    // Возвращаем массив избранных фильмов или сериалов по соответствующему типу
    return $favorites[$type];
  }
}
?>
